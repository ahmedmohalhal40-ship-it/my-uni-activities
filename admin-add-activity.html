<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <script>
        const pass = prompt("Enter Passkey:");
        if (pass !== "29112002") { alert("Incorrect Passkey!"); window.location.href = "login.html"; }
    </script>
    <meta charset="UTF-8">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© | Ø¥Ø¶Ø§ÙØ© ÙˆØ­Ø°Ù Ø§Ù„Ø£Ù†Ø´Ø·Ø©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>body { font-family: 'Cairo', sans-serif; }</style>
</head>
<body class="bg-gray-100 p-4 md:p-8">

    <div class="max-w-5xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-8">
        
        <div class="bg-white p-6 rounded-2xl shadow-lg border-t-4 border-blue-600 h-fit">
            <h2 class="text-2xl font-bold mb-6 text-gray-800 flex items-center gap-2">
                <span>â•</span> Ø¥Ø¶Ø§ÙØ© Ù†Ø´Ø§Ø· Ø¬Ø¯ÙŠØ¯
            </h2>
            <form id="activity-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">Ø§Ø³Ù… Ø§Ù„Ù†Ø´Ø§Ø·</label>
                    <input type="text" id="title" class="w-full p-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" placeholder="" required>
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">ÙˆØµÙ Ø§Ù„Ù†Ø´Ø§Ø·</label>
                    <textarea id="description" rows="2" class="w-full p-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" placeholder="ÙˆØµÙ Ø³Ø±ÙŠØ¹ Ù„Ù„Ù†Ø´Ø§Ø·..."></textarea>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">Ø§Ù„ÙŠÙˆÙ…</label>
                        <input type="text" id="day" class="w-full p-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" placeholder="Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†" required>
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                        <input type="text" id="date" class="w-full p-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" placeholder="2026/02/15" required>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">Ø§Ù„Ù…Ø¹Ø§Ø¯ (Ø³Ø§Ø¹Ø© Ø§Ù„Ù†Ø´Ø§Ø·)</label>
                    <input type="text" id="dates" class="w-full p-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" placeholder="Ø§Ù„Ø³Ø§Ø¹Ø© 12 Ø¸Ù‡Ø±Ø§Ù‹" required>
                </div>
                <button type="submit" id="submit-btn" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold hover:bg-blue-700 transition-all shadow-md">
                    Ù†Ø´Ø± Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø¢Ù†
                </button>
            </form>
            <p id="msg" class="mt-4 text-center hidden font-bold"></p>
        </div>

        <div class="bg-white p-6 rounded-2xl shadow-lg border-t-4 border-red-500 h-fit">
            <h2 class="text-2xl font-bold mb-6 text-gray-800 flex items-center gap-2">
                <span>ğŸ“‹</span> Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø© Ø­Ø§Ù„ÙŠØ§Ù‹
            </h2>
            <div id="activities-list" class="space-y-4 max-h-[500px] overflow-y-auto pr-2">
                <p class="text-center text-gray-400 py-10">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©...</p>
            </div>
        </div>

    </div>

<script>
    const supabaseUrl = 'https://laddhhupcublqpbcklyn.supabase.co';
    const supabaseKey = 'sb_publishable_wMLIZBnNAXFU4lvHt8B8tA_xbgQZhEH';
    const _supabase = supabase.createClient(supabaseUrl, supabaseKey);

    const form = document.getElementById('activity-form');
    const msg = document.getElementById('msg');
    const listDiv = document.getElementById('activities-list');

    // 1. Ø¬Ù„Ø¨ Ø§Ù„Ø£Ù†Ø´Ø·Ø© ÙˆØ¹Ø±Ø¶Ù‡Ø§
    async function loadActivities() {
        const { data, error } = await _supabase
            .from('activities')
            .select('*')
            .order('created_at', { ascending: false });

        if (error) {
            listDiv.innerHTML = `<p class="text-red-500">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„</p>`;
            return;
        }

        if (data.length === 0) {
            listDiv.innerHTML = `<div class="text-center py-10"><p class="text-gray-400">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ù†Ø´Ø·Ø© Ù…Ø¶Ø§ÙØ©</p></div>`;
            return;
        }

        listDiv.innerHTML = data.map(act => `
            <div class="p-4 border rounded-xl bg-gray-50 flex justify-between items-center group hover:bg-white transition-all border-gray-100 hover:border-red-200">
                <div class="flex-1">
                    <h3 class="font-bold text-blue-700">${act.title}</h3>
                    <p class="text-xs text-gray-500 mt-1">${act.day} | ${act.date} | ${act.dates}</p>
                </div>
                <button onclick="deleteActivity(${act.id}, '${act.title}')" class="text-red-500 hover:bg-red-50 p-2 rounded-lg transition" title="Ø­Ø°Ù">
                    ğŸ—‘ï¸
                </button>
            </div>
        `).join('');
    }

    // 2. Ø¥Ø¶Ø§ÙØ© Ù†Ø´Ø§Ø· Ø¬Ø¯ÙŠØ¯
    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const btn = document.getElementById('submit-btn');
        btn.disabled = true;
        btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...";

        const activityData = {
            title: document.getElementById('title').value,
            description: document.getElementById('description').value,
            day: document.getElementById('day').value,
            date: document.getElementById('date').value,
            dates: document.getElementById('dates').value
        };

        const { error } = await _supabase.from('activities').insert([activityData]);

        if (error) {
            msg.innerText = "âŒ ÙØ´Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ©: " + error.message;
            msg.className = "mt-4 text-center text-red-600 block";
        } else {
            msg.innerText = "âœ… ØªÙ… Ù†Ø´Ø± Ø§Ù„Ù†Ø´Ø§Ø· Ø¨Ù†Ø¬Ø§Ø­!";
            msg.className = "mt-4 text-center text-green-600 block";
            form.reset();
            loadActivities(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙÙˆØ±Ø§Ù‹
        }
        btn.disabled = false;
        btn.innerText = "Ù†Ø´Ø± Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø¢Ù†";
        setTimeout(() => msg.classList.add('hidden'), 3000);
    });

    // 3. Ø­Ø°Ù Ù†Ø´Ø§Ø·
    async function deleteActivity(id, title) {
        if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù†Ø´Ø§Ø· (${title})ØŸ`)) return;

        const { error } = await _supabase.from('activities').delete().eq('id', id);
        
        if (error) {
            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù");
        } else {
            loadActivities(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙÙˆØ±Ø§Ù‹
        }
    }

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
    loadActivities();
</script>
</body>
</html>
